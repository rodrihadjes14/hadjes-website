<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Listing Detail</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Fonts: Exo 2 (headlines) + Open Sans (body) -->
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@500;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">

</head>
  

<body class="sidebar-layout"> 
  

  <header>
  <div class="header-logo-and-search">
      <a href="index.html" class="brand-button">Hadjes Propiedades</a>

    <div class="filter-bar">
      <div class="filter-options">
      <label><input type="radio" name="operation" value="venta"> Venta / Buy</label>
      <label><input type="radio" name="operation" value="alquiler"> Alquiler / Rent</label>
      <label><input type="radio" name="operation" value="temporal"> Alquiler Temporal / Temporary Rent</label>
    </div>

    <select class="property-type" name="type">
      <option value="">Propiedad</option>
      <option value="casa">Casa</option>
      <option value="departamento">Departamento</option>
      <option value="edificio">Edificio</option>
      <option value="cochera">Cochera</option>
      <option value="local">Local</option>
      <option value="oficina">Oficina</option>
      <option value="campo">Campo</option>
      <option value="lote">Lote</option>
    </select>


    <input name="q" type="text" class="search-input" placeholder="Ubicaci√≥n / Location, keyword..." /> 
    <button id="search-button" class="search-button">Buscar</button>
   </div>
  </div>
  </header>
  
  <!--FILTROS BUTTON!!!!!!-->
  
  <button id="open-sidebar" class="mobile-toggle-button">‚ò∞ Filtros</button>

  

<!-- SIDEBAR -->
  
  <div class="page-layout">
  
  <div id="sidebar-wrapper">
  <aside class="sidebar-filters">
    <form id="sidebar-form">
      <h3>Filtrar Propiedades</h3>
    
      <div class="dropdown-filter">
        <button class="dropdown-toggle">Operaci√≥n</button>
        <div class= "dropdown-content input-group">
        <label><input type="radio" name="operation" value="venta"> Venta</label>
        <label><input type="radio" name="operation" value="alquiler"> Alquiler</label>
        <label><input type="radio" name="operation" value="temporal"> Temporal</label>
       </div>
      </div>

      <div class="dropdown-filter">
        <button class="dropdown-toggle">Tipo de Propiedad:</button>
        <div class= "dropdown-content input-group">
        <label><input type="checkbox" name="type" value="casa"> Casa</label>
        <label><input type="checkbox" name="type" value="departamento"> Departamento</label>
        <label><input type="checkbox" name="type" value="oficina"> Oficina</label>
        <label><input type="checkbox" name="type" value="local"> Local</label>
        </div>
      </div>


      <div class="dropdown-filter">
        <button class="dropdown-toggle">Ubicaci√≥n:</button>
        <div class= "dropdown-content input-group">
        <label><input type="checkbox" name="location" value="belgrano"> Belgrano</label>
        <label><input type="checkbox" name="location" value="palermo"> Palermo</label>
        <label><input type="checkbox" name="location" value="recoleta"> Recoleta</label>
       </div>
      </div>


      <div class="dropdown-filter">
        <button class="dropdown-toggle">Ambientes:</button>
        <div class= "dropdown-content input-group">
        <label><input type="checkbox" name="ambientes" value="1"> 1</label>
        <label><input type="checkbox" name="ambientes" value="2"> 2</label>
        <label><input type="checkbox" name="ambientes" value="3"> 3</label>
        <label><input type="checkbox" name="ambientes" value="4"> 4+</label>
       </div>
      </div>


      <div class="dropdown-filter">
        <button class="dropdown-toggle">Precio M√≠nimo</button>
        <div class= "dropdown-content input-group">
        <label>Precio M√≠nimo:</label>
        <input type="number" name="priceMin" />
        </div>
      </div>

        <div class="dropdown-filter">
        <button class="dropdown-togggle">Precio M√°ximo</button>
        <div class= "dropdown-content input group">
        <label>Precio M√°ximo:</label>
        <input type="number" name="priceMax" />
      </div>
      </div>
      

      <button id="sidebar-search-button" type="submit">Filtrar</button>
    </form>
  </aside>
</div>
    



  <!-- SIDEBAR -->

  
  <div id="listings">
    <p>Loading listing...</p>
  </div>
    
  </div>
  

<script>
  
  const params = new URLSearchParams(window.location.search);
  const slug = params.get('slug');
  
  async function fetchListings() {
    const res = await fetch('https://hadjes-backend.onrender.com/listings');
    const listings = await res.json();

  // SIDEBAR MODIFICATION BACKUP RESERVE
    
    const params = new URLSearchParams(window.location.search);

    const types = params.get('type')?.split(',') || [];
    const operation = params.get('operation');
    const locations = params.get('location')?.split(',') || [];
    const ambientes = params.get('ambientes')?.split(',') || [];
    const priceMin = parseFloat(params.get('priceMin'));
    const priceMax = parseFloat(params.get('priceMax'));
    const keyword = params.get('q')?.toLowerCase() || '';

    const filtered = listings.filter(listing => {
    const matchOperation = !operation || listing.operation === operation;
    const matchType = types.length === 0 || types.includes(listing.type);
    const matchLocation = locations.length === 0 || locations.includes(listing.location);
    const matchAmbientes = ambientes.length === 0 || ambientes.includes(String(listing.ambientes));
    const matchPriceMin = isNaN(priceMin) || listing.price >= priceMin;
    const matchPriceMax = isNaN(priceMax) || listing.price <= priceMax;
    const matchKeyword = !keyword ||
      listing.title.toLowerCase().includes(keyword) ||
      listing.description.toLowerCase().includes(keyword) ||
      listing.location.toLowerCase().includes(keyword);

    return matchOperation && matchType && matchLocation && matchAmbientes && matchPriceMin && matchPriceMax && matchKeyword;
  });

  const listingsDiv = document.getElementById('listings');
  listingsDiv.innerHTML = '';

  if (filtered.length === 0) {
    listingsDiv.innerHTML = '<p>No se encontraron propiedades que coincidan.</p>';
    return;
  }

  filtered.forEach(listing => {
    const div = document.createElement('div');
    div.className = 'listing';
    div.innerHTML = `
      <a href="listing.html?slug=${listing.slug || listing._id}" style="text-decoration: none; color: inherit;">
        <div class="listing-box">
          <img src="${listing.imageUrl}" width="300" />
          <h3>${listing.title}</h3>
          <p>${listing.description}</p>
          <p><strong>Precio:</strong> $${listing.price}</p>
          <p><strong>Ubicaci√≥n:</strong> ${listing.location}</p>
        </div>
      </a>
    `;
    listingsDiv.appendChild(div);
  });
}

  // SIDEBAR MODIFICATION
  
  async function fetchSingleListing(slug) {
  try {
    const res = await fetch('https://hadjes-backend.onrender.com/listings');
    const listings = await res.json();

    const listing = listings.find(item => item.slug === slug || item._id === slug);

    const container = document.getElementById('listings');
    container.innerHTML = '';

    if (!listing) {
      container.innerHTML = '<p>‚ùå Listing not found.</p>';
      return;
    }

    const div = document.createElement('div');
    div.className = 'listing-detail';
    div.innerHTML = `
      <h2>${listing.title}</h2>
      <img src="${listing.imageUrl}" width="400" />
      <p>${listing.description}</p>
      <p><strong>Price:</strong> $${listing.price}</p>
      <p><strong>Location:</strong> ${listing.location}</p>
      <p><strong>Type:</strong> ${listing.type}</p>
      <p><strong>Operation:</strong> ${listing.operation}</p>
    `;
    container.appendChild(div);
  } catch (err) {
    console.error('Error loading single listing:', err);
  }
}
  // SIDEBAR FUNCTIONS
  
  document.addEventListener('DOMContentLoaded', () => {
  const sidebarBtn = document.getElementById('sidebar-search-button');
  if (sidebarBtn) {
    sidebarBtn.addEventListener('click', function (e) {
      e.preventDefault();

      const params = new URLSearchParams();

      // Get checked types
      const types = Array.from(document.querySelectorAll('input[name="type"]:checked')).map(i => i.value);
      if (types.length) params.set('type', types.join(','));

      // Operation
      const operation = document.querySelector('input[name="operation"]:checked')?.value;
      if (operation) params.set('operation', operation);

      // Locations
      const locations = Array.from(document.querySelectorAll('input[name="location"]:checked')).map(i => i.value);
      if (locations.length) params.set('location', locations.join(','));

      // Ambientes
      const ambientes = Array.from(document.querySelectorAll('input[name="ambientes"]:checked')).map(i => i.value);
      if (ambientes.length) params.set('ambientes', ambientes.join(','));

      // Price min/max
      const priceMin = document.querySelector('input[name="priceMin"]')?.value;
      const priceMax = document.querySelector('input[name="priceMax"]')?.value;
      if (priceMin) params.set('priceMin', priceMin);
      if (priceMax) params.set('priceMax', priceMax);

      // Redirect to filtered URL
      window.location.href = `listing.html?${params.toString()}`;
    });
  }
});

  //SIDEBAR FUNCTIONS
  
    document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('search-button');
    if (btn) {
      btn.addEventListener('click', function (e) {
        e.preventDefault();

        const params = new URLSearchParams();

        // ‚úÖ Keyword input
        const q = document.querySelector('input[name="q"]')?.value;
        if (q) params.set('q', q);

        // ‚úÖ Operation radio
        const operation = document.querySelector('input[name="operation"]:checked')?.value;
        if (operation) params.set('operation', operation);

        // ‚úÖ Property type dropdown
        const type = document.querySelector('select[name="type"]')?.value;
        if (type) params.set('type', type);

        // üöÄ Redirect with all selected filters
        window.location.href = `listing.html?${params.toString()}`;
      });
    }
  });

  document.addEventListener('DOMContentLoaded', () => {
  if (slug) {
    fetchSingleListing(slug);
  } else {
    fetchListings();
  }
});
</script>


  
<script>
  
  // TOGGLE RESPONSIVE MOBILE SIDEBAR OPERATIONS //
  
  document.addEventListener('DOMContentLoaded', () => {
    const openBtn = document.getElementById('open-sidebar');
    const sidebar = document.getElementById('sidebar-wrapper');

    openBtn?.addEventListener('click', () => {
      sidebar.classList.toggle('show-mobile');
    });

    // Optional: Close sidebar if clicked outside (mobile only)
    document.addEventListener('click', (e) => {
      if (
        window.innerWidth <= 768 &&
        sidebar.classList.contains('show-mobile') &&
        !sidebar.contains(e.target) &&
        e.target !== openBtn
      ) {
        sidebar.classList.remove('show-mobile');
      }
    });

    // Optional: Close on ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        sidebar.classList.remove('show-mobile');
      }
    });
  });
</script>

  
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.dropdown-toggle').forEach(button => {
    button.addEventListener('click', () => {
      const content = button.nextElementSibling;
      const isOpen = content.style.display === 'block';

      document.querySelectorAll('.dropdown-content').forEach(c => c.style.display = 'none');
      document.querySelectorAll('.dropdown-toggle').forEach(b => b.classList.remove('open'));

      content.style.display = isOpen ? 'none' : 'block';
      button.classList.toggle('open', !isOpen);
    });
  });
});
</script>


</body>
</html>
